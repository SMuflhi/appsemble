name: Waarnemingen
defaultPage: Maak waarneming

theme:
  splashColor: '#FFFFFF'
  themeColor: '#eb0000'

resources:
  waarneming:
    url: https://api.stadswerken.amsterdam/waarnemingen_real
    blobs:
      url: 'https://api.stadswerken.amsterdam/upload'
      serialize: custom
  waarnemingFake:
    url: https://api.stadswerken.amsterdam/waarnemingen

authentication:
  - method: email
    url: https://api.stadswerken.amsterdam/login
    refreshURL: https://api.stadswerken.amsterdam/token/refresh

pages:
  - name: Maak waarneming
    scope:
      - '*'
    blocks:
      - type: form
        version: 0.5.0
        parameters:
          fields:
            - name: locatie
              label: Locatie
              type: geocoordinates
            - name: proces
              label: Proces
              enum:
                - value: Fietsknip team
                - value: Handhaving
                - value: Heel en Groen
                - value: Inzameling
            - name: notities
              label: Notities
              placeholder: Bijv. Er ligt een fiets in de bosjes.
              type: string
              multiline: true
            - name: fotos
              label: Fotoâ€™s
              type: file
              accept:
                - image/jpeg
              repeated: true
        actions:
          submit:
            type: splash
            blocks:
              - type: '@amsterdam/splash'
                version: 0.5.0
                actions:
                  load:
                    type: resource.create
                    resource: waarneming
                  error:
                    type: splash.error
                  success:
                    type: link
                    to: Overzichtskaart

  - name: Overzichtskaart
    scope:
      - '*'
    blocks:
      - type: map
        version: 0.5.0
        parameters:
          latitude: locatie.latitude
          longitude: locatie.longitude
        actions:
          markerClick:
            type: link
            to: Waarneming details
          load:
            type: resource.query
            resource: waarneming
            query:
              $orderBy: 'created_at desc'
              $top: 50
      - type: action-button
        version: 0.5.0
        actions:
          click:
            type: link
            to: Maak waarneming

  - name: Waarnemingen lijst
    scope:
      - '*'
    blocks:
      - type: feed
        version: 0.5.0
        parameters:
          title: proces
          subtitle: id|upper
          heading: created_at
          picture: fotos.0
          pictureBase: https://api.stadswerken.amsterdam/uploads
          description: notities

        actions:
          load:
            type: resource.query
            resource: waarneming
            query:
              $orderBy: 'created_at desc'
              $top: 50

  - name: Waarneming details
    scope:
      - '*'
    parameters:
      - id
    blocks:
      - type: detail-viewer
        version: 0.5.0
        parameters:
          fileBase: 'https://api.stadswerken.amsterdam/uploads'
          fields:
            - name: locatie
              label: Locatie
              type: geocoordinates
              longitude: longitude # locatie.longitude
              latitude: latitude # locatie.latitude
            - name: proces
              label: Proces
            - name: notities
              label: Notities
            - name: fotos
              label: Foto's
              type: file
              repeated: true
        actions:
          load:
            type: resource.get
            resource: waarneming
