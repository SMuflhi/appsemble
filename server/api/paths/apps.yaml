/apps:
  post:
    tags: [app]
    description: Create a new app
    consumes:
      - multipart/form-data
    x-oai-middleware:
      - file: apps
        handler: create
    parameters:
      - name: app
        in: formData
        type: string
        description: The app to create.
        required: false # oai-router does not properly validate this for multipart
      - name: organizationId
        in: formData
        type: number
        required: false
      - name: style
        in: formData
        type: file
        description: The custom style to apply to the app.
        required: false
    responses:
      201:
        description: The app that was created.
        schema:
          $ref: '#/definitions/App'
      default:
        $ref: '#/responses/default'
    security:
      - oauthPassword:
          - apps:write
  get:
    tags: [app]
    description: Get all existing apps.
    x-oai-middleware:
      - file: apps
        handler: query
    responses:
      200:
        description: The list of all apps.
        schema:
          type: array
          items:
            $ref: '#/definitions/App'
      default:
        $ref: '#/responses/default'
    security:
      - oauthPassword:
          - apps:read
/apps/me:
  get:
    tags: [app]
    description: Get all apps that are editable by the user.
    x-oai-middleware:
      - file: apps
        handler: queryMyApps
    responses:
      200:
        description: The list of all editable apps.
        schema:
          type: array
          items:
            $ref: '#/definitions/App'
      default:
        $ref: '#/responses/default'
    security:
      - oauthPassword:
          - apps:read

/apps/{id}:
  get:
    tags: [app]
    description: Get a single app
    x-oai-middleware:
      - file: apps
        handler: getOne
    parameters:
      - name: id
        in: path
        description: The id of the app to get.
        required: true
        type: integer
    responses:
      200:
        description: The app that matches the given id.
        schema:
          $ref: '#/definitions/App'
      default:
        $ref: '#/responses/default'
  put:
    tags: [app]
    description: Update an existing app
    consumes:
      - multipart/form-data
    x-oai-middleware:
      - file: apps
        handler: update
    parameters:
      - name: id
        in: path
        description: The id of the app to update.
        required: true
        type: integer
      - name: app
        in: formData
        type: string
        description: The app to create.
        required: false # oai-router does not properly validate this for multipart
      - name: style
        in: formData
        type: file
        description: The custom style to apply to the app.
        required: false
    responses:
      200:
        description: The updated app.
        schema:
          $ref: '#/definitions/App'
      default:
        $ref: '#/responses/default'
    security:
      - oauthPassword:
          - apps:write

/apps/{id}/icon:
  get:
    tags: [app]
    description: Get the current app Icon.
    x-oai-middleware:
      - file: apps
        handler: getAppIcon
    parameters:
      - name: id
        in: path
        description: The id of the app whose icon to update.
        required: true
        type: integer
    responses:
      200:
        description: The icon of the app that matches the given id.
      default:
        $ref: '#/responses/default'

  post:
    tags: [app]
    description: |
      Change the app icon.

      If no icon has been specified, the Appsemble icon will be served.
    consumes:
      # These are the underlying formats that are supported by our underlying image processing library, sharp.
      # http://sharp.pixelplumbing.com/en/stable/#formats
      # image/gif has been excluded, because those tend to contain multiple frames.
      - image/jpeg
      - image/png
      - image/tiff
      - image/webp
      - image/xml+svg
    x-oai-middleware:
      - file: apps
        handler: setAppIcon
    parameters:
      - name: id
        in: path
        description: The id of the app whose icon to update.
        required: true
        type: integer
      - name: icon
        in: body
        description: The new app icon.
        required: true
        schema:
          type: object
    responses:
      204:
        description: The icon has been updated succesfully.
      default:
        $ref: '#/responses/default'
    security:
      - oauthPassword:
          - apps:write
  delete:
    tags: [app]
    description: |
      Delete the app icon from the database.

      When the app icon has been deleted, the Appsemble icon will be served.
    x-oai-middleware:
      - file: apps
        handler: deleteAppIcon
    parameters:
      - name: id
        in: path
        description: The id of the app whose icon to delete.
        required: true
        type: integer
    responses:
      204:
        description: The icon has been deleted succesfully.
      default:
        $ref: '#/responses/default'
    security:
      - oauthPassword:
          - apps:write
/apps/{id}/style/core:
  get:
    tags: [app]
    description: Get the core style for this app.
    x-oai-middleware:
      - file: apps
        handler: getAppStyle
    parameters:
      - name: id
        in: path
        description: The id of the app.
        required: true
        type: integer
    responses:
      200:
        description: The core stylesheet associated with this app.
      default:
        $ref: '#/responses/default'
/apps/{id}/style/shared:
  get:
    tags: [app]
    description: Get the shared style for this app.
    x-oai-middleware:
      - file: apps
        handler: getSharedAppStyle
    parameters:
      - name: id
        in: path
        description: The id of the app.
        required: true
        type: integer
    responses:
      200:
        description: The shared stylesheet associated with this app.
      default:
        $ref: '#/responses/default'
